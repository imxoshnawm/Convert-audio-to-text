<!DOCTYPE html>
<html lang="ku">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kurdish Speech-to-Text</title>
    <link rel="stylesheet" href="style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #6C5CE7;
            --primary-dark: #5649c0;
            --secondary-color: #00D2D3;
            --accent-color: #FF9FF3;
            --dark-color: #2C3E50;
            --light-color: #f8f9fa;
            --white: #ffffff;
            --success-color: #00B894;
            --error-color: #FF6B6B;
            --warning-color: #FDCB6E;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 100%;
            margin: 0;
            padding: 0;
            direction: rtl;
            background: linear-gradient(135deg, #a29bfe, #6C5CE7);
            color: var(--dark-color);
            height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 30px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.4em;
            font-weight: 700;
            position: relative;
            padding-bottom: 15px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
        }

        .feature-box {
            background: linear-gradient(145deg, var(--white), var(--light-color));
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary-color);
            animation: slideInRight 0.8s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .feature-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
        }

        .feature-title::before {
            content: '•';
            margin-left: 8px;
            color: var(--accent-color);
            font-size: 1.5em;
        }

        .feature-box p {
            margin: 8px 0;
            padding-right: 20px;
            position: relative;
        }

        .feature-box p::before {
            content: '✓';
            position: absolute;
            right: 0;
            color: var(--success-color);
        }

        .record-button-container {
            text-align: center;
            position: relative;
            margin: 40px 0;
            perspective: 1000px;
        }

        .record-button {
            background: linear-gradient(145deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 0;
            border-radius: 50%;
            width: 170px;
            height: 170px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(108, 92, 231, 0.5), 
                        0 5px 10px rgba(0, 0, 0, 0.1);
            transform-style: preserve-3d;
        }

        .record-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0) 100%);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        .record-button:hover {
            transform: translateY(-8px) scale(1.03) rotateY(5deg);
            box-shadow: 0 20px 35px rgba(108, 92, 231, 0.6),
                        0 10px 15px rgba(0, 0, 0, 0.15);
        }

        .record-button:active, .record-button.recording {
            background: linear-gradient(145deg, var(--error-color), #ff4757);
            transform: scale(0.97);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }

        .recording-indicator {
            position: absolute;
            top: -10px;
            right: calc(50% - 85px);
            width: 25px;
            height: 25px;
            background-color: var(--error-color);
            border-radius: 50%;
            display: none;
            z-index: 2;
        }

        .recording-indicator.active {
            display: block;
            animation: pulse 1.2s infinite, orbitRecordButton 4s infinite linear;
        }

        @keyframes orbitRecordButton {
            0% {
                transform: rotate(0deg) translateX(95px) rotate(0deg);
            }
            100% {
                transform: rotate(360deg) translateX(95px) rotate(-360deg);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(0.8);
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
            }
            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 12px rgba(255, 107, 107, 0);
            }
            100% {
                transform: scale(0.8);
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
            }
        }

        .timer {
            font-size: 24px;
            text-align: center;
            margin: 15px 0;
            font-weight: 600;
            display: none;
            animation: fadeIn 0.5s;
            color: var(--primary-color);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .status {
            color: var(--dark-color);
            margin: 20px 0;
            text-align: center;
            font-size: 16px;
            padding: 12px;
            border-radius: 50px;
            background-color: var(--light-color);
            border: 1px solid rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.5s;
        }

        .status.recording {
            color: white;
            background: linear-gradient(to right, var(--error-color), #ff4757);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            animation: pulse-light 1.5s infinite;
        }

        @keyframes pulse-light {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
            }
        }

        .status.processing {
            color: white;
            background: linear-gradient(to right, var(--warning-color), #ffeaa7);
            color: var(--dark-color);
            box-shadow: 0 5px 15px rgba(253, 203, 110, 0.4);
            animation: processing 1.5s infinite;
        }

        @keyframes processing {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .status.success {
            color: white;
            background: linear-gradient(to right, var(--success-color), #55efc4);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }

        .status.error {
            color: white;
            background: linear-gradient(to right, var(--error-color), #ff4757);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .audio-container {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(145deg, var(--white), var(--light-color));
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            animation: fadeInUp 0.8s ease-out 0.3s;
            animation-fill-mode: both;
        }

        #audioPlayer {
            width: 100%;
            height: 50px;
            border-radius: 50px;
            background-color: var(--light-color);
            color: var(--primary-color);
        }

        textarea {
            width: 100%;
            height: 200px;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            font-size: 18px;
            direction: rtl;
            resize: vertical;
            background-color: var(--white);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            animation: fadeInUp 0.8s ease-out 0.6s;
            animation-fill-mode: both;
        }

        textarea:focus {
            border-color: var(--primary-color);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05), 
                        0 0 15px rgba(108, 92, 231, 0.3);
            outline: none;
        }

        .text-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            animation: fadeInUp 0.8s ease-out 0.5s;
            animation-fill-mode: both;
        }

        .button {
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.2),
                rgba(255, 255, 255, 0)
            );
            transition: left 0.5s;
        }

        .button:hover::before {
            left: 100%;
        }

        .copy-button {
            background: linear-gradient(to right, var(--success-color), #55efc4);
            color: white;
            margin-right: 10px;
        }

        .copy-button:hover {
            background: linear-gradient(to right, #02a882, #00B894);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
        }

        .clear-button {
            background: linear-gradient(to right, var(--error-color), #ff7675);
            color: white;
        }

        .clear-button:hover {
            background: linear-gradient(to right, #e74c3c, #ff4757);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .button-icon {
            display: inline-block;
            margin-left: 8px;
            font-size: 1.2em;
        }

        /* Wave Animation for Recording */
        .wave-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 170px;
            height: 170px;
            border-radius: 50%;
            z-index: -1;
            opacity: 0;
        }

        .wave {
            position: absolute;
            border-radius: 50%;
            background: rgba(108, 92, 231, 0.3);
            opacity: 0;
            transform: scale(1);
            animation: wave 2s infinite;
        }

        .wave-container.recording {
            opacity: 1;
        }

        .wave:nth-child(2) {
            animation-delay: 0.3s;
        }

        .wave:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes wave {
            0% {
                transform: scale(0);
                opacity: 0.8;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        /* Microphone Icon */
        .mic-icon {
            width: 50px;
            height: 50px;
            position: relative;
            margin: 0 auto 15px;
        }

        .mic-body {
            width: 24px;
            height: 52px;
            border-radius: 12px;
            background: white;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .mic-head {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 8px solid white;
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .mic-stand {
            width: 8px;
            height: 15px;
            background: white;
            position: absolute;
            left: 50%;
            bottom: -15px;
            transform: translateX(-50%);
        }

        .mic-base {
            width: 30px;
            height: 5px;
            background: white;
            position: absolute;
            left: 50%;
            bottom: -20px;
            transform: translateX(-50%);
            border-radius: 3px;
        }

        .recording-waves {
            position: absolute;
            bottom: 8px;
            left: 0;
            right: 0;
            height: 20px;
            display: flex;
            justify-content: center;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .recording .recording-waves {
            opacity: 1;
        }

        .wave-bar {
            width: 3px;
            background-color: white;
            border-radius: 3px;
            animation: waveAnimation 0.5s infinite alternate;
        }

        .wave-bar:nth-child(1) { animation-delay: 0.1s; }
        .wave-bar:nth-child(2) { animation-delay: 0.2s; }
        .wave-bar:nth-child(3) { animation-delay: 0.3s; }
        .wave-bar:nth-child(4) { animation-delay: 0.4s; }
        .wave-bar:nth-child(5) { animation-delay: 0.5s; }

        @keyframes waveAnimation {
            0% {
                height: 5px;
            }
            100% {
                height: 20px;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 15px;
            }
            h1 {
                font-size: 1.8em;
            }
            .record-button {
                width: 130px;
                height: 130px;
                font-size: 15px;
            }
            .button {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
        /* ڕێسپۆنسیڤ کردنی گشتی */
@media (max-width: 768px) {
    .container {
        padding: 20px 15px;
        margin: 10px;
        border-radius: 15px;
    }
    
    h1 {
        font-size: 1.6em;
        margin-bottom: 20px;
        padding-bottom: 10px;
    }
    
    h1::after {
        width: 80px;
        height: 3px;
    }
    
    .feature-box {
        padding: 15px;
        margin: 20px 0;
    }
    
    .feature-title {
        font-size: 1.1em;
        margin-bottom: 10px;
    }
    
    .record-button-container {
        margin: 30px 0;
    }
    
    .record-button {
        width: 140px;
        height: 140px;
        font-size: 14px;
    }
    
    .mic-icon {
        width: 40px;
        height: 40px;
    }
    
    .mic-body {
        width: 20px;
        height: 44px;
    }
    
    .mic-head {
        width: 36px;
        height: 36px;
        border: 7px solid white;
    }
    
    .text-controls {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .button {
        padding: 10px 20px;
        font-size: 14px;
    }
    
    textarea {
        height: 150px;
        padding: 15px;
        font-size: 16px;
    }
    
    .audio-container {
        padding: 15px;
    }
    
    #audioPlayer {
        height: 40px;
    }
    
    .timer {
        font-size: 20px;
    }
    
    .status {
        font-size: 14px;
        padding: 10px;
    }
}

/* ڕێسپۆنسیڤ کردنی تایبەت بۆ مۆبایلی بچووک */
@media (max-width: 480px) {
    .container {
        padding: 15px 12px;
        margin: 8px;
        border-radius: 12px;
    }
    
    h1 {
        font-size: 1.4em;
        margin-bottom: 15px;
    }
    
    h1::after {
        width: 60px;
    }
    
    .feature-box {
        padding: 12px;
        margin: 15px 0;
    }
    
    .feature-title {
        font-size: 1em;
    }
    
    .record-button {
        width: 120px;
        height: 120px;
        font-size: 12px;
    }
    
    .recording-indicator {
        top: -8px;
        right: calc(50% - 60px);
        width: 20px;
        height: 20px;
    }
    
    @keyframes orbitRecordButton {
        0% {
            transform: rotate(0deg) translateX(70px) rotate(0deg);
        }
        100% {
            transform: rotate(360deg) translateX(70px) rotate(-360deg);
        }
    }
    
    .mic-icon {
        width: 35px;
        height: 35px;
        margin-bottom: 10px;
    }
    
    .mic-body {
        width: 18px;
        height: 40px;
    }
    
    .mic-head {
        width: 32px;
        height: 32px;
        border: 6px solid white;
    }
    
    .text-controls {
        gap: 8px;
    }
    
    .button {
        padding: 8px 16px;
        font-size: 13px;
        margin-right: 5px;
    }
    
    textarea {
        height: 120px;
        padding: 12px;
        font-size: 15px;
        margin: 15px 0;
    }
    
    .timer {
        font-size: 18px;
        margin: 10px 0;
    }
    
    .status {
        margin: 15px 0;
        font-size: 13px;
        padding: 8px;
    }
    
    /* چاککردنی دووگمەکان بۆ مۆبایل */
    .text-controls > div {
        display: flex;
        width: 100%;
        justify-content: space-between;
    }
    
    .copy-button, .clear-button {
        flex: 1;
        margin: 0 5px;
    }
    
    .button-icon {
        margin-left: 9px;
    }
}

/* باشترکردنی تایبەتمەندییەکانی تەچ بۆ مۆبایل */
@media (hover: none) and (pointer: coarse) {
    .record-button {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }
    
    .record-button:active {
        transform: scale(0.95);
    }
    
    .button {
        -webkit-tap-highlight-color: transparent; 
        touch-action: manipulation;
    }
    
    /* چاککردنی کێشەی تەچ لە iOS */
    body {
        cursor: pointer;
        -webkit-user-select: none;
        user-select: none;
    }
    
    textarea {
        -webkit-user-select: text;
        user-select: text;
    }
}

/* چارەسەرکردنی کێشەی ئاڕاستەی نووسین بۆ مۆبایل */
@media (max-width: 768px) {
    .container {
        direction: rtl;
        text-align: right;
    }
    
    .text-controls {
        width: 100%;
    }
    
    /* چاککردنی بەتەواوەتی دووگمەکان بۆ مۆبایل */
    @media (max-width: 400px) {
        .text-controls > div {
            flex-direction: column;
            width: 100%;
        }
        
        .copy-button, .clear-button {
            width: 100%;
            margin: 5px 0;
            justify-content: center;
        }
    }
}

/* چاککردنی شەقامەی ژێرەوە لە iOS */
@supports (-webkit-touch-callout: none) {
    body {
        min-height: -webkit-fill-available;
    }
}

/* باشترکردنی ئەنیمەیشنەکان بۆ مۆبایل */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* چاککردنی کێشەی زووم لە مۆبایل کاتێک زوومی پەیجەکە دەکەیت */
@media (max-width: 768px) {
    body {
        overflow-x: hidden;
        max-width: 100vw;
    }
    
    .container {
        max-width: 100%;
        overflow: hidden;
    }
    
    .wave-container.recording {
        opacity: 0.7;
    }
}

/* چارەسەرکردنی کێشەی مەودای نێوان ئیلیمێنتەکان لە مۆبایل */
@media (max-width: 480px) {
    .feature-box p {
        margin: 5px 0;
    }
    
    .audio-container {
        margin: 15px 0;
    }
}

/* باشترکردنی دەرکەوتنی دووگمەکە لە مۆبایل */
@media (max-width: 480px) {
    .record-button:hover {
        transform: none;
    }
    
    .record-button:active {
        background: linear-gradient(145deg, var(--error-color), #ff4757);
        transform: scale(0.97);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
    }
}

.language-selector {
    width: 100%;
    padding: 12px 15px;
    border-radius: 10px;
    background-color: var(--white);
    border: 1px solid rgba(0, 0, 0, 0.1);
    font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 16px;
    color: var(--dark-color);
    cursor: pointer;
    margin-top: 12px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    direction: rtl;
    text-align: right;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236C5CE7' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: left 15px center;
    background-size: 16px;
    padding-left: 40px;
}

.language-selector:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
}

.language-selector:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

/* کاریگەری هۆڤەر */
.language-selector option {
    background-color: var(--white);
    color: var(--dark-color);
    padding: 10px;
}

/* ڕێسپۆنسیڤ کردن */
@media (max-width: 768px) {
    .language-selector-container {
        padding: 15px;
        margin: 20px 0;
    }
    
    .language-selector {
        padding: 10px 15px;
        font-size: 15px;
        background-position: left 10px center;
        padding-left: 35px;
    }
}

@media (max-width: 480px) {
    .language-selector-container {
        padding: 12px;
        margin: 15px 0;
    }
    
    .language-selector {
        padding: 8px 12px;
        font-size: 14px;
        background-position: left 8px center;
        padding-left: 30px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <h1>ID_Kurdm AI بۆ گۆڕینی دەنگ بۆ تێکست </h1>
        <div class="feature-box">
            <div class="feature-title">ڕێنمایی:</div>
            <div class="language-selector-container">
                <div class="feature-title">زمان هەڵبژێرە / Select Language:</div>
                <select id="languageSelector" class="language-selector">
                    <option value="ku-sorani">کوردی (سۆرانی) - Kurdish (Sorani)</option>
                    <option value="ku-sorani-latini"> Kurdish (Sorani) latini</option>

                    <option value="ku-badini">کوردی (بادینی) - Kurdish (badini)</option>
                    <option value="ku-kurmanji">کوردی (کرمانجی) - Kurdish (kurmanji)</option>
                    <option value="en">English - ئینگلیزی</option>
                    <!-- Add more languages here in the future -->
                </select>
            </div>
            <p>دوگمەی خوارەوە داگرە و بیگرە بۆ تۆمارکردنی دەنگ</p>
            <p>بە کوردی (سۆرانی) قسە بکە</p>
            <p>دوگمەکە بەردە بۆ کۆتایی هێنان بە تۆمارکردن</p>
            <p>چاوەڕێ بکە تا دەنگەکەت دەگۆڕدرێت بۆ نووسین</p>
        </div>
    

        <div class="record-button-container">
            <div class="recording-indicator" id="recordingIndicator"></div>
            <div class="wave-container" id="waveContainer">
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
            </div>
            <div class="record-button" id="recordButton">
                <div class="mic-icon">
                    <div class="mic-head"></div>
                    <div class="mic-body"></div>
                    <div class="mic-stand"></div>
                    <div class="mic-base"></div>
                    <div class="recording-waves">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>
                <span id="recordButtonText">پەنجە دابنێ بۆ تۆمارکردن</span>
            </div>
            <div class="timer" id="timer">00:00</div>
        </div>
        
        <div class="status" id="status">ئامادەیە بۆ تۆمارکردن</div>
        
        <div class="audio-container">
            <div class="feature-title">گوێگرتنەوە لە دەنگی تۆمارکراو:</div>
            <audio id="audioPlayer" controls></audio>
        </div>
        
        <div class="text-controls">
            <div class="feature-title">دەقی تۆمارکراو:</div>
            <div>
                <button class="button copy-button" id="copyButton">
                    <span class="button-icon">📋</span>
                    <span id="copyButtonText">کۆپی کردن</span>
                </button>
                <button class="button clear-button" id="clearButton">
                    <span class="button-icon">🗑️</span>
                    <span id="clearButtonText">پاککردنەوە</span>
                </button>
            </div>
        </div>
        <textarea id="result" placeholder="دەقەکە لێرە دەردەکەوێت..." readonly></textarea>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let mediaRecorder;
            let audioChunks = [];
            let audioBlob;
            let audioUrl;
            let stream;
            let timerInterval;
            let seconds = 0;
            let minutes = 0;
            let recording = false; // گۆڕاوێک بۆ زانینی دۆخی تۆمارکردن
            
            // API key stored in the backend
            const GEMINI_API_KEY = "AIzaSyDwutX11TvHE7_V0DZl92VETg-AleuXozQ";
            
         
    // Language related elements and texts
    const languageSelector = document.getElementById('languageSelector');
    const recordButtonText = document.getElementById('recordButtonText');
    const copyButtonText = document.getElementById('copyButtonText');
    const clearButtonText = document.getElementById('clearButtonText');
    const result = document.getElementById('result');
    
    // UI elements
    const recordButton = document.getElementById('recordButton');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const waveContainer = document.getElementById('waveContainer');
    const timer = document.getElementById('timer');
    const copyButton = document.getElementById('copyButton');
    const clearButton = document.getElementById('clearButton');
    const status = document.getElementById('status');
    const audioPlayer = document.getElementById('audioPlayer');
    
    // Find all text elements that need translation
    // Adding more selectors to include all text elements in the page
    const pageTitle = document.querySelector('title');
    const mainHeading = document.querySelector('h1');
    const instructionTexts = document.querySelectorAll('.feature-box p');
    const featureTitles = document.querySelectorAll('.feature-title');
    
    // Language-specific text content
    const languageTexts = {
        'ku-badini': {
            recordButton: 'پەنجی دانە سەر بۆ تۆمارکرن',
            copyButton: 'کۆپی کرن',
            copied: 'کۆپی کرا!',
            clearButton: 'پاککرن',
            statusReady: 'ئامادەیە بۆ تۆمارکرنێ',
            statusRequestingPermission: 'داخازکرنا دەستوورێ بۆ مایکرۆفۆنێ...',
            statusRecording: 'تۆمارکرن...',
            statusStopped: 'تۆمارکرن راوەستیا، چاڤەرێی شرۆڤەکرنا دەنگی...',
            statusProcessing: 'شرۆڤەکرنا دەنگی...',
            statusComplete: 'شرۆڤەکرن تەمام بوو!',
            statusErrorNoMic: 'هەلە: چ مایکرۆفۆن نەهاتنە دیتن!',
            statusErrorPermission: 'هەلە: دەستگەهشتن ب مایکرۆفۆنێ رێپێدای نینە. تکایە د رێکخستنێن گەروکێ خوەدا دەستوورێ بدە.',
            statusErrorRecording: 'هەڵە لە تۆمارکردن: ',
            statusErrorNoAudio: 'هەلە: چ دەنگ نەهاتنە تۆمارکرن.',
            statusErrorProcessing: 'هەڵە لە ئامادەکردنی دەنگ: ',
            statusErrorAPI: 'هەلە: د وەرگرتنا بەرسڤێدا. تکایە دووبارە هەول بدە.',
            promptText: 'تکایە ئەم دەنگە کوردیانەی خوارەوە بۆ دەق بنووسنەوە. زمانی کوردی (سۆرانی)ە. ئەگەر ناتوانن ئاخاوتنی کوردی دەستنیشان بکەن، تکایە ئاگادارم بکەنەوە.',
            textareaPlaceholder: 'دەق دێ لڤێرێ دەرکەڤیت...',
            // نووسینەکانی زیاتر
            pageTitle: 'بادینی دەنگ-بۆ-تێکست',
            mainHeading: 'ID_Kurdm AI بۆ گۆڕینی دەنگ بۆ تێکست',
            instructions: [
                'ڕێنمایی:',
                'زمان هەڵبژێرە / Select Language:',
                'دوگمەی خوارەوە داگرە و بیگرە بۆ تۆمارکرنێ',
                'بە کوردی (بادینی) قسە بکە',
                'دوگمەکە بەردە بۆ کۆتایی هێنان بە تۆمارکرنێ',
                'چاوەڕێ بکە تا دەنگەکەت دەگۆڕدرێت بۆ نڤیسین'
            ],
            featureTitles: [
                'ڕێنمایی:',
                'زمان هەڵبژێرە / Select Language:',
                'گوێگرتنەوە لە دەنگی تۆمارکراو:',
                'دەقی تۆمارکراو:'
            ]
        },
        'ku-kurmanji': {
            recordButton: 'Tiliya xwe lêde bo tomarkirinê',
            copyButton: 'Kopî ke',
            copied: 'Hat kopîkirin!',
            clearButton: 'Pakkirin',
            statusReady: 'Amadeye bo tomarkirinê',
            statusRequestingPermission: 'Daxwaza destûrê bo mîkrofonê...',
            statusRecording: 'Tomarkirin...',
            statusStopped: 'Tomarkirin sekinî, hêvîdarim bo şirovekirina dengî...',
            statusProcessing: 'Şirovekirina dengî...',
            statusComplete: 'Şirovekirin temam bû!',
            statusErrorNoMic: 'Çewtî: Tu mîkrofon nehatin dîtin!',
            statusErrorPermission: 'Çewtî: Gihîştina mîkrofonê rêpêdan nîne. Ji kerema xwe di tenzîmên gerrokê xweda destûrê bide.',
            statusErrorRecording: 'Çewtî li tomarkirinê: ',
            statusErrorNoAudio: 'Çewtî: Tu deng nehatiye tomarkirin.',
            statusErrorProcessing: 'Çewtî li amadekirina dengî: ',
            statusErrorAPI: 'Çewtî: Di wergirtina bersivêda. Ji kerema xwe dîsan hewl bide.',
            promptText: 'Ji kerema xwe van dengên kurdî yên li jêr bo deq binivîse. Zimanê kurdî (Kurmancî) ye. Eger hûn nikarin axaftina kurdî destnîşan bikin, ji kerema xwe min agahdar bikin.',
            textareaPlaceholder: 'Deq dê li vir xuya be...',
            // نووسینەکانی زیاتر
            pageTitle: 'Kurmancî Deng-bo-Nivîs',
            mainHeading: 'ID_Kurdm AI bo guherandina deng bo nivîs',
            instructions: [
                'Rêberî:',
                'Ziman hilbijêre / Select Language:',
                'Bişkoka jêrîn bigire û deyne bo tomarkirinê',
                'Bi kurdî (kurmancî) biaxive',
                'Bişkokê berde bo bidawîkirina tomarkirinê',
                'Çavê xwe li rê be heta ku dengê te tê guhertin ji bo nivîsê'
            ],
            featureTitles: [
                'Rêberî:',
                'Ziman hilbijêre / Select Language:',
                'Guhdarkirina dengê tomarkirî:',
                'Nivîsa tomarkirî:'
            ]
        },
        'ku-sorani': {
            recordButton: 'پەنجە دابنێ بۆ تۆمارکردن',
            copyButton: 'کۆپی کردن',
            copied: 'کۆپی کرا!',
            clearButton: 'پاککردنەوە',
            statusReady: 'ئامادەیە بۆ تۆمارکردن',
            statusRequestingPermission: 'داواکردنی مۆڵەت بۆ مایکرۆفۆن...',
            statusRecording: 'تۆمارکردن...',
            statusStopped: 'تۆمارکردن وەستا، چاوەڕوانی شیکردنەوەی دەنگ...',
            statusProcessing: 'شیکردنەوەی دەنگ...',
            statusComplete: 'شیکردنەوە تەواو بوو!',
            statusErrorNoMic: 'هەڵە: هیچ مایکرۆفۆنێک نەدۆزرایەوە!',
            statusErrorPermission: 'هەڵە: دەستپێڕاگەیشتن بە مایکرۆفۆن ڕێگەپێدراو نییە. تکایە لە سێتینگی براوسەرەکەت مۆڵەت بدە.',
            statusErrorRecording: 'هەڵە لە تۆمارکردن: ',
            statusErrorNoAudio: 'هەڵە: هیچ دەنگێک تۆمار نەکرا.',
            statusErrorProcessing: 'هەڵە لە ئامادەکردنی دەنگ: ',
            statusErrorAPI: 'هەڵە لە وەرگرتنی وەڵام. تکایە دووبارە هەوڵبدەوە.',
            promptText: 'تکایە ئەم دەنگە کوردیانەی خوارەوە بۆ دەق بنووسنەوە. زمانی کوردی (سۆرانی)ە. ئەگەر ناتوانن ئاخاوتنی کوردی دەستنیشان بکەن، تکایە ئاگادارم بکەنەوە.',
            textareaPlaceholder: 'دەقەکە لێرە دەردەکەوێت...',
            // نووسینەکانی زیاتر
            pageTitle: 'کوردی دەنگ-بۆ-تێکست',
            mainHeading: 'ID_Kurdm AI بۆ گۆڕینی دەنگ بۆ تێکست',
            instructions: [
                'ڕێنمایی:',
                'زمان هەڵبژێرە / Select Language:',
                'دوگمەی خوارەوە داگرە و بیگرە بۆ تۆمارکردن',
                'بە کوردی (سۆرانی) قسە بکە',
                'دوگمەکە بەردە بۆ کۆتایی هێنان بە تۆمارکردن',
                'چاوەڕێ بکە تا دەنگەکەت دەگۆڕدرێت بۆ نووسین'
            ],
            featureTitles: [
                'ڕێنمایی:',
                'زمان هەڵبژێرە / Select Language:',
                'گوێگرتنەوە لە دەنگی تۆمارکراو:',
                'دەقی تۆمارکراو:'
            ]
        },
        'ku-sorani-latini': {
            recordButton: 'پەنجە دابنێ بۆ تۆمارکردن',
            copyButton: 'کۆپی کردن',
            copied: 'کۆپی کرا!',
            clearButton: 'پاککردنەوە',
            statusReady: 'ئامادەیە بۆ تۆمارکردن',
            statusRequestingPermission: 'داواکردنی مۆڵەت بۆ مایکرۆفۆن...',
            statusRecording: 'تۆمارکردن...',
            statusStopped: 'تۆمارکردن وەستا، چاوەڕوانی شیکردنەوەی دەنگ...',
            statusProcessing: 'شیکردنەوەی دەنگ...',
            statusComplete: 'شیکردنەوە تەواو بوو!',
            statusErrorNoMic: 'هەڵە: هیچ مایکرۆفۆنێک نەدۆزرایەوە!',
            statusErrorPermission: 'هەڵە: دەستپێڕاگەیشتن بە مایکرۆفۆن ڕێگەپێدراو نییە. تکایە لە سێتینگی براوسەرەکەت مۆڵەت بدە.',
            statusErrorRecording: 'هەڵە لە تۆمارکردن: ',
            statusErrorNoAudio: 'هەڵە: هیچ دەنگێک تۆمار نەکرا.',
            statusErrorProcessing: 'هەڵە لە ئامادەکردنی دەنگ: ',
            statusErrorAPI: 'هەڵە لە وەرگرتنی وەڵام. تکایە دووبارە هەوڵبدەوە.',
            promptText: 'Tkaya am danga kurdianay khwarawa bo daq bnusnawa. Zmani kurdi (sorani)a. Agar natwanin akhaftni kurdi dastnishankan, tkaya agadarm bkanawa. tkaia jga la latini hichitr manusa tania latini.',
            textareaPlaceholder: 'دەقەکە لێرە دەردەکەوێت...',
            // نووسینەکانی زیاتر
            pageTitle: 'کوردی دەنگ-بۆ-تێکست',
            mainHeading: 'ID_Kurdm AI بۆ گۆڕینی دەنگ بۆ تێکست',
            instructions: [
                'ڕێنمایی:',
                'زمان هەڵبژێرە / Select Language:',
                'دوگمەی خوارەوە داگرە و بیگرە بۆ تۆمارکردن',
                'بە کوردی (سۆرانی) قسە بکە',
                'دوگمەکە بەردە بۆ کۆتایی هێنان بە تۆمارکردن',
                'چاوەڕێ بکە تا دەنگەکەت دەگۆڕدرێت بۆ نووسین'
            ],
            featureTitles: [
                'ڕێنمایی:',
                'زمان هەڵبژێرە / Select Language:',
                'گوێگرتنەوە لە دەنگی تۆمارکراو:',
                'دەقی تۆمارکراو:'
            ]
        },
        'en': {
            recordButton: 'Press and hold to record',
            copyButton: 'Copy',
            copied: 'Copied!',
            clearButton: 'Clear',
            statusReady: 'Ready to record',
            statusRequestingPermission: 'Requesting microphone permission...',
            statusRecording: 'Recording...',
            statusStopped: 'Recording stopped, waiting for transcription...',
            statusProcessing: 'Processing audio...',
            statusComplete: 'Transcription complete!',
            statusErrorNoMic: 'Error: No microphone found!',
            statusErrorPermission: 'Error: Microphone access denied. Please allow access in your browser settings.',
            statusErrorRecording: 'Error recording: ',
            statusErrorNoAudio: 'Error: No audio was recorded.',
            statusErrorProcessing: 'Error processing audio: ',
            statusErrorAPI: 'Error receiving response. Please try again.',
            promptText: 'Please transcribe the following English audio to text. If you cannot identify English speech, please let me know.',
            textareaPlaceholder: 'Transcription will appear here...',
            // Additional texts
            pageTitle: 'English Speech-to-Text',
            mainHeading: 'ID_Kurdm AI for Speech to Text Conversion',
            instructions: [
                'Instructions:',
                'Select Language:',
                'Press and hold the button below to record',
                'Speak in English',
                'Release the button to end recording',
                'Wait for your voice to be transcribed'
            ],
            featureTitles: [
                'Instructions:',
                'Select Language:',
                'Listen to recorded audio:',
                'Transcribed text:'
            ]
        }
        // Add more languages here in the future
    };
    
    // Enhanced function to update UI text based on selected language
    function updateUILanguage(languageCode) {
        const texts = languageTexts[languageCode];
        if (!texts) return;
        
        // Basic UI elements
        recordButtonText.textContent = texts.recordButton;
        copyButtonText.textContent = texts.copyButton;
        clearButtonText.textContent = texts.clearButton;
        status.textContent = texts.statusReady;
        result.placeholder = texts.textareaPlaceholder;
        
        // Update document title
        if (pageTitle) {
            pageTitle.textContent = texts.pageTitle;
        }
        
        // Update main heading
        if (mainHeading) {
            mainHeading.textContent = texts.mainHeading;
        }
        
        // Update instruction paragraphs
        if (instructionTexts && instructionTexts.length > 0) {
            for (let i = 0; i < Math.min(instructionTexts.length, texts.instructions.length); i++) {
                instructionTexts[i].textContent = texts.instructions[i];
            }
        }
        
        // Update feature titles
        if (featureTitles && featureTitles.length > 0) {
            for (let i = 0; i < Math.min(featureTitles.length, texts.featureTitles.length); i++) {
                featureTitles[i].textContent = texts.featureTitles[i];
            }
        }
    }
    
    // Event listener for language change
    if (languageSelector) {
        languageSelector.addEventListener('change', function() {
            updateUILanguage(this.value);
        });
    }
    
    // Initialize with default language
    updateUILanguage(languageSelector.value);
    
    // Add pulse animation when page loads
    setTimeout(() => {
        if (recordButton) {
            recordButton.classList.add('pulse');
            setTimeout(() => {
                recordButton.classList.remove('pulse');
            }, 2000);
        }
    }, 1000);
    
    if (recordButton) {
        // Separate event handling for desktop and mobile
        // For desktop
        recordButton.addEventListener('mousedown', function(e) {
            e.preventDefault();
            if (!recording) {
                handleRecordButtonPress();
            }
        });
        
        recordButton.addEventListener('mouseup', function(e) {
            e.preventDefault();
            if (recording) {
                stopRecording();
            }
        });
        
        // If mouse leaves, stop recording
        recordButton.addEventListener('mouseleave', function(e) {
            if (recording) {
                stopRecording();
            }
        });
        
        // For mobile
        recordButton.addEventListener('touchstart', function(e) {
            e.preventDefault();
            if (!recording) {
                handleRecordButtonPress();
            }
        });
        
        recordButton.addEventListener('touchend', function(e) {
            e.preventDefault();
            if (recording) {
                stopRecording();
            }
        });
    }
    
    if (copyButton) {
        copyButton.addEventListener('click', function() {
            if (result.value) {
                result.select();
                document.execCommand('copy');
                // Show feedback
                const currentLang = languageSelector.value;
                copyButtonText.textContent = languageTexts[currentLang].copied;
                copyButton.style.background = "linear-gradient(to right, #00B894, #00cec9)";
                setTimeout(() => {
                    copyButtonText.textContent = languageTexts[currentLang].copyButton;
                    copyButton.style.background = "linear-gradient(to right, var(--success-color), #55efc4)";
                }, 2000);
            }
        });
    }
    
    if (clearButton) {
        clearButton.addEventListener('click', function() {
            // Add a small animation before clearing
            result.style.opacity = "0.5";
            setTimeout(() => {
                result.value = "";
                result.style.opacity = "1";
            }, 300);
        });
    }
    
    function updateTimer() {
        seconds++;
        if (seconds >= 60) {
            seconds = 0;
            minutes++;
        }
        if (timer) {
            timer.textContent = 
                (minutes < 10 ? "0" + minutes : minutes) + ":" + 
                (seconds < 10 ? "0" + seconds : seconds);
        }
    }
    
    // Function to start the process normally
    async function handleRecordButtonPress() {
        const currentLang = languageSelector.value;
        
        if (status) {
            status.textContent = languageTexts[currentLang].statusRequestingPermission;
            status.classList.remove('recording', 'error', 'success', 'processing');
        }
        
        try {
            // Request microphone permission
            stream = await navigator.mediaDevices.getUserMedia({ 
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true,
                    autoGainControl: true
                } 
            });
            
            // After getting permission, start recording
            startRecording();
            
        } catch (error) {
            console.error('Error accessing microphone:', error);
            
            if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                if (status) {
                    status.textContent = languageTexts[currentLang].statusErrorPermission;
                    status.classList.add('error');
                }
            } else {
                if (status) {
                    status.textContent = languageTexts[currentLang].statusErrorRecording + error.message;
                    status.classList.add('error');
                }
            }
        }
    }
    
            // This function is called only after permission is granted
            function startRecording() {
                const currentLang = languageSelector.value;
                recording = true; // Start recording
                audioChunks = [];
                
                // Now that we have stream, we can create mediaRecorder
                try {
                    mediaRecorder = new MediaRecorder(stream);
                    
                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = processRecording;
                    
                    // Important: Make sure there are no errors before starting
                    mediaRecorder.onerror = (event) => {
                        console.error('MediaRecorder error:', event.error);
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusErrorRecording + event.error;
                            status.classList.add('error');
                        }
                        stopRecording();
                    };
                    
                    // Start recording with a 100ms update
                    mediaRecorder.start(100);
                    
                    if (recordButton) {
                        recordButton.classList.add('recording');
                        
                        // Change microphone icon
                        recordButtonText.textContent = '';
                        
                        // Create mic icon
                        const newMicIconDiv = document.createElement('div');
                        newMicIconDiv.className = 'mic-icon recording';
                        
                        const micHead = document.createElement('div');
                        micHead.className = 'mic-head';
                        
                        const micBody = document.createElement('div');
                        micBody.className = 'mic-body';
                        
                        const micStand = document.createElement('div');
                        micStand.className = 'mic-stand';
                        
                        const micBase = document.createElement('div');
                        micBase.className = 'mic-base';
                        
                        const recordingWaves = document.createElement('div');
                        recordingWaves.className = 'recording-waves';
                        
                        for (let i = 0; i < 5; i++) {
                            const waveBar = document.createElement('div');
                            waveBar.className = 'wave-bar';
                            recordingWaves.appendChild(waveBar);
                        }
                        
                        newMicIconDiv.appendChild(micHead);
                        newMicIconDiv.appendChild(micBody);
                        newMicIconDiv.appendChild(micStand);
                        newMicIconDiv.appendChild(micBase);
                        newMicIconDiv.appendChild(recordingWaves);
                        
                        recordButton.appendChild(newMicIconDiv);
                    }
                    
                    if (status) {
                        status.textContent = languageTexts[currentLang].statusRecording;
                        status.classList.add('recording');
                    }
                    
                    // Show indicator
                    if (recordingIndicator) {
                        recordingIndicator.classList.add('active');
                    }
                    
                    if (waveContainer) {
                        waveContainer.classList.add('recording');
                    }
                    
                    // Start timer
                    seconds = 0;
                    minutes = 0;
                    if (timer) {
                        timer.textContent = "00:00";
                        timer.style.display = 'block';
                        timerInterval = setInterval(updateTimer, 1000);
                    }
                } catch (error) {
                    console.error('Error starting MediaRecorder:', error);
                    if (status) {
                        status.textContent = languageTexts[currentLang].statusErrorRecording + error.message;
                        status.classList.add('error');
                    }
                    recording = false;
                }
            }
            
            function stopRecording() {
                const currentLang = languageSelector.value;
                if (!recording) return; // If recording has already ended, do nothing
                
                recording = false; // End recording
                
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    try {
                        mediaRecorder.stop();
                        
                        // Turn off audio tracks
                        if (stream) {
                            stream.getTracks().forEach(track => track.stop());
                        }
                        
                        // Stop timer
                        clearInterval(timerInterval);
                        
                        if (recordButton) {
                            recordButton.classList.remove('recording');
                            
                            // Restore button text
                            recordButton.innerHTML = '';
                            const newMicIcon = document.createElement('div');
                            newMicIcon.className = 'mic-icon';
                            
                            const micHead = document.createElement('div');
                            micHead.className = 'mic-head';
                            
                            const micBody = document.createElement('div');
                            micBody.className = 'mic-body';
                            
                            const micStand = document.createElement('div');
                            micStand.className = 'mic-stand';
                            
                            const micBase = document.createElement('div');
                            micBase.className = 'mic-base';
                            
                            newMicIcon.appendChild(micHead);
                            newMicIcon.appendChild(micBody);
                            newMicIcon.appendChild(micStand);
                            newMicIcon.appendChild(micBase);
                            
                            recordButton.appendChild(newMicIcon);
                            recordButtonText.textContent = languageTexts[currentLang].recordButton;
                            recordButton.appendChild(recordButtonText);
                        }
                        
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusStopped;
                            status.classList.remove('recording');
                            status.classList.add('processing');
                        }
                        
                        // Remove indicators
                        if (recordingIndicator) {
                            recordingIndicator.classList.remove('active');
                        }
                        
                        if (waveContainer) {
                            waveContainer.classList.remove('recording');
                        }
                    } catch (error) {
                        console.error('Error stopping recording:', error);
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusErrorRecording + error.message;
                            status.classList.add('error');
                        }
                    }
                }
            }
            
            function processRecording() {
                const currentLang = languageSelector.value;
                // Make sure audio chunks exist
                if (audioChunks.length === 0) {
                    if (status) {
                        status.textContent = languageTexts[currentLang].statusErrorNoAudio;
                        status.classList.remove('processing');
                        status.classList.add('error');
                    }
                    return;
                }
                
                try {
                    audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    
                    if (audioPlayer) {
                        audioPlayer.src = audioUrl;
                        audioPlayer.style.display = 'block';
                    }
                    
                    // Convert to base64 and send to Gemini API
                    const reader = new FileReader();
                    reader.onloadend = function() {
                        try {
                            const base64data = reader.result.split(',')[1];
                            transcribeAudio(base64data);
                        } catch (error) {
                            console.error('Error processing audio to base64:', error);
                            if (status) {
                                status.textContent = languageTexts[currentLang].statusErrorProcessing + error.message;
                                status.classList.remove('processing');
                                status.classList.add('error');
                            }
                        }
                    };
                    
                    reader.onerror = function(error) {
                        console.error('FileReader error:', error);
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusErrorProcessing + error.message;
                            status.classList.remove('processing');
                            status.classList.add('error');
                        }
                    };
                    
                    reader.readAsDataURL(audioBlob);
                } catch (error) {
                    console.error('Error creating audio blob:', error);
                    if (status) {
                        status.textContent = languageTexts[currentLang].statusErrorProcessing + error.message;
                        status.classList.remove('processing');
                        status.classList.add('error');
                    }
                }
            }
            
            async function transcribeAudio(audioBase64) {
                const currentLang = languageSelector.value;
                if (!audioBase64) {
                    if (status) {
                        status.textContent = languageTexts[currentLang].statusErrorNoAudio;
                        status.classList.remove('processing');
                        status.classList.add('error');
                    }
                    return;
                }
                
                if (status) {
                    status.textContent = languageTexts[currentLang].statusProcessing;
                    status.classList.remove('recording');
                    status.classList.add('processing');
                }
                
                // Handle errors properly
                try {
                    // Using Gemini 2.0 Flash model for audio recording
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: languageTexts[currentLang].promptText
                                }, {
                                    inline_data: {
                                        mime_type: "audio/webm",
                                        data: audioBase64
                                    }
                                }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(`API response: ${response.status} ${response.statusText}. ${errorData}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                        const resultText = data.candidates[0].content.parts[0].text;
                        
                        if (result) {
                            // Animation for showing result
                            result.style.opacity = "0";
                            setTimeout(() => {
                                result.value = resultText;
                                result.style.opacity = "1";
                            }, 300);
                        }
                        
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusComplete;
                            status.classList.remove('processing');
                            status.classList.add('success');
                            
                            // After 3 seconds, reset status
                            setTimeout(() => {
                                status.style.opacity = "0";
                                setTimeout(() => {
                                    status.textContent = languageTexts[currentLang].statusReady;
                                    status.classList.remove('success');
                                    status.style.opacity = "1";
                                }, 300);
                            }, 3000);
                        }
                    } else {
                        if (result) {
                            result.value = languageTexts[currentLang].statusErrorAPI;
                        }
                        
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusErrorAPI;
                            status.classList.remove('processing');
                            status.classList.add('error');
                            
                            setTimeout(() => {
                                status.style.opacity = "0";
                                setTimeout(() => {
                                    status.textContent = languageTexts[currentLang].statusReady;
                                    status.classList.remove('error');
                                    status.style.opacity = "1";
                                }, 300);
                            }, 3000);
                        }
                        
                        console.error('API Error:', data);
                    }
                } catch (error) {
                    if (result) {
                        result.value = languageTexts[currentLang].statusErrorProcessing + error.message;
                    }
                    
                    if (status) {
                        status.textContent = languageTexts[currentLang].statusErrorProcessing + error.message;
                        status.classList.remove('processing');
                        status.classList.add('error');
                        
                        setTimeout(() => {
                            status.style.opacity = "0";
                            setTimeout(() => {
                                status.textContent = languageTexts[currentLang].statusReady;
                                status.classList.remove('error');
                                status.style.opacity = "1";
                            }, 300);
                        }, 3000);
                    }
                    
                    console.error('Error:', error);
                }
            }
            
            // Adding a function to check if microphone is available
            async function checkMicrophoneAvailability() {
                const currentLang = languageSelector.value;
                try {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    const hasMicrophone = devices.some(device => device.kind === 'audioinput');
                    
                    if (!hasMicrophone) {
                        if (status) {
                            status.textContent = languageTexts[currentLang].statusErrorNoMic;
                            status.classList.add('error');
                        }
                        if (recordButton) {
                            recordButton.disabled = true;
                            recordButton.style.opacity = "0.5";
                            recordButton.style.cursor = "not-allowed";
                        }
                    }
                } catch (error) {
                    console.error('Error checking devices:', error);
                }
            }
            
            // Try to resolve permission issues
            if (navigator.permissions && navigator.permissions.query) {
                navigator.permissions.query({ name: 'microphone' })
                    .then(permissionStatus => {
                        const currentLang = languageSelector.value;
                        if (permissionStatus.state === 'granted') {
                            if (status) {
                                status.textContent = languageTexts[currentLang].statusReady;
                            }
                        } else if (permissionStatus.state === 'denied') {
                            if (status) {
                                status.textContent = languageTexts[currentLang].statusErrorPermission;
                                status.classList.add('error');
                            }
                        }
                        
                        // Monitor permission changes
                        permissionStatus.onchange = function() {
                            const currentLang = languageSelector.value;
                            if (this.state === 'granted') {
                                if (status) {
                                    status.textContent = languageTexts[currentLang].statusReady;
                                    status.classList.remove('error');
                                }
                            } else {
                                if (status) {
                                    status.textContent = languageTexts[currentLang].statusErrorPermission;
                                    status.classList.add('error');
                                }
                            }
                        };
                    })
                    .catch(error => {
                        console.error('Error checking permission:', error);
                    });
            }
            
            // Check if microphone is available from the beginning
            checkMicrophoneAvailability();
        });
            </script>
</body>
</html>
